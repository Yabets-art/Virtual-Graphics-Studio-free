<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editable Logo/Business Card Editor</title>
  <script src="https://cdn.jsdelivr.net/npm/fabric@6.4.3/dist/index.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .context-menu {
      position: absolute;
      background: white;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border: 1px solid #ddd;
      z-index: 1000;
      display: none;
    }
    .context-menu button {
      display: block;
      width: 100%;
      padding: 8px 12px;
      text-align: left;
      border: none;
      background: none;
      cursor: pointer;
    }
    .context-menu button:hover {
      background: #f3f3f3;
    }
  </style>
</head>
<body class="flex h-screen bg-gray-100">

  <!-- Sidebar -->
  <div class="w-1/4 bg-white shadow-md flex flex-col p-4">
    <h2 class="text-lg font-semibold mb-4">Actions</h2>
    <button class="w-full py-2 px-4 bg-blue-500 text-white text-sm rounded hover:bg-blue-600" onclick="addText()">Add Text</button>
    <button class="w-full py-2 px-4 bg-green-500 text-white text-sm rounded hover:bg-green-600" onclick="addRectangle()">Add Rectangle</button>
    <button class="w-full py-2 px-4 bg-yellow-500 text-white text-sm rounded hover:bg-yellow-600" onclick="addCircle()">Add Circle</button>
    <button class="w-full py-2 px-4 bg-gray-500 text-white text-sm rounded hover:bg-gray-600" onclick="undo()">Undo</button>
    <button class="w-full py-2 px-4 bg-gray-500 text-white text-sm rounded hover:bg-gray-600" onclick="redo()">Redo</button>
  </div>

  <!-- Main Editor Area -->
  <div class="flex-1 flex justify-center items-center bg-white relative">
    <canvas id="canvas" width="800" height="600"></canvas>
    <!-- Right-click context menu -->
    <div id="contextMenu" class="context-menu">
      <button onclick="deleteSelected()">Delete</button>
      <button onclick="bringToFront()">Bring to Front</button>
      <button onclick="sendToBack()">Send to Back</button>
    </div>
  </div>

  <script>
    // Fabric.js Canvas Setup
    const canvas = new fabric.Canvas('canvas', {
      backgroundColor: 'white',
    });

    // History tracking for Undo/Redo
    let history = [];
    let currentHistoryIndex = -1;

    function saveState() {
      // Save the current state of the canvas for undo/redo functionality
      if (currentHistoryIndex < history.length - 1) {
        history = history.slice(0, currentHistoryIndex + 1);
      }
      history.push(JSON.stringify(canvas.toJSON()));
      currentHistoryIndex++;
    }

    function undo() {
      if (currentHistoryIndex > 0) {
        currentHistoryIndex--;
        canvas.loadFromJSON(history[currentHistoryIndex], canvas.renderAll.bind(canvas));
      }
    }

    function redo() {
      if (currentHistoryIndex < history.length - 1) {
        currentHistoryIndex++;
        canvas.loadFromJSON(history[currentHistoryIndex], canvas.renderAll.bind(canvas));
      }
    }

    // Add Text
    function addText() {
      const text = new fabric.Textbox('Double-click to edit', {
        left: 100,
        top: 100,
        width: 200,
        fontSize: 24,
        fontFamily: 'Helvetica, Arial, sans-serif',
        fill: '#000',
        editable: true,
        cornerSize: 12,
        borderColor: '#ccc',
        padding: 10,
      });

      text.on('mousedown', function () {
        text.set({ fill: 'blue' });
        canvas.renderAll();
      });

      text.on('blur', function () {
        text.set({ fill: '#000' });
        canvas.renderAll();
        saveState();
      });

      canvas.add(text);
      canvas.setActiveObject(text);
      saveState();
    }

    // Add Rectangle
    function addRectangle() {
      const rect = new fabric.Rect({
        left: 100,
        top: 100,
        width: 150,
        height: 100,
        fill: 'white',
        draggable: true,
      });
      canvas.add(rect);
      saveState();
    }

    // Add Circle
    function addCircle() {
      const circle = new fabric.Circle({
        left: 150,
        top: 150,
        radius: 50,
        fill: 'blue',
        draggable: true,
      });
      canvas.add(circle);
      saveState();
    }

    // Delete Selected Object
    function deleteSelected() {
      const selectedObject = canvas.getActiveObject();
      if (selectedObject) {
        canvas.remove(selectedObject);
        saveState();
      }
      hideContextMenu();
    }

    // Bring to Front
    function bringToFront() {
      const selectedObject = canvas.getActiveObject();
      if (selectedObject) {
        selectedObject.bringToFront();
        saveState();
      }
      hideContextMenu();
    }

    // Send to Back
    function sendToBack() {
      const selectedObject = canvas.getActiveObject();
      if (selectedObject) {
        selectedObject.sendToBack();
        saveState();
      }
      hideContextMenu();
    }

    // Right-click context menu functionality
    const contextMenu = document.getElementById('contextMenu');

    canvas.on('mouse:down', function (options) {
      if (options.target) {
        canvas.setActiveObject(options.target);
      } else {
        canvas.discardActiveObject();
      }
    });

    canvas.on('mouse:up', function (options) {
      if (options.target) {
        contextMenu.style.left = options.e.clientX + 'px';
        contextMenu.style.top = options.e.clientY + 'px';
        contextMenu.style.display = 'block';
      } else {
        contextMenu.style.display = 'none';
      }
    });

    // Hide Context Menu
    document.addEventListener('click', function () {
      contextMenu.style.display = 'none';
    });

    // Save initial state
    saveState();
  </script>
</body>
</html>
